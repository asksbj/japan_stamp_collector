{% extends "base.html" %}

{% block head_extra %}
  <script src="https://unpkg.com/vue@3.4.21/dist/vue.global.prod.js"></script>
{% endblock head_extra %}

{% block content %}
{% raw %}
  <section class="layout-grid layout-grid-fuke">
    <aside class="side-column">
      <div class="side-card">
        <h2 class="side-heading">風景印 · Fuke</h2>
        <p class="side-intro">
          Official website: <a href="https://www.post.japanpost.jp/kitte_hagaki/stamp/fuke/" target="_blank">https://www.post.japanpost.jp/kitte_hagaki/stamp/fuke/</a>
        </p>
      </div>
    </aside>

    <section class="main-column">
      <div id="fuke-app" class="fuke-app-root">
        <section class="filter-strip">
          <div class="filter-header">
            <h1 class="filter-title">Search Fukei-in</h1>
            <p class="filter-subtitle">Please use your browser's built-in translation feature for the displayed results.</p>
          </div>
          <div class="filter-controls">
            <div class="filter-controls-row filter-controls-row-top">
            <div class="filter-control">
              <label for="prefecture-select" class="filter-label">
                都道府県 Prefecture
              </label>
              <div class="filter-select-wrapper" :class="{ 'is-loading': loading.prefectures }">
                <select
                  id="prefecture-select"
                  v-model="selectedPrefId"
                  @change="onPrefectureChange"
                >
                  <option :value="null">Select prefecture…</option>
                  <option
                    v-for="pref in prefectures"
                    :key="pref.id"
                    :value="pref.pref_id"
                  >
                    {{ padPref(pref.pref_id) }} ｜ {{ pref.full_name }} ({{ pref.en_name }})
                  </option>
                </select>
                <span class="filter-select-icon">
                  <i class="fa-solid fa-chevron-down"></i>
                </span>
              </div>
            </div>

            <div class="filter-control">
              <label for="city-select" class="filter-label">
                市郡区 City
              </label>
              <div class="filter-select-wrapper" :class="{ 'is-disabled': !selectedPrefId, 'is-loading': loading.cities }">
                <select
                  id="city-select"
                  v-model="selectedCityId"
                  :disabled="!selectedPrefId"
                  @change="onCityChange"
                >
                  <option :value="null">
                    {{ selectedPrefId ? 'Select city…' : 'Select prefecture first…' }}
                  </option>
                  <option
                    v-for="city in cities"
                    :key="city.id"
                    :value="city.id"
                  >
                    {{ city.name }} ({{ city.reading || 'よみかた' }})
                  </option>
                </select>
                <span class="filter-select-icon">
                  <i class="fa-solid fa-chevron-down"></i>
                </span>
              </div>
            </div>
            </div>

            <div class="filter-controls-row filter-controls-row-bottom">
            <div class="filter-secondary-controls">
              <label for="office-name-input" class="filter-label">
                郵便局名 Post office
              </label>
              <input
                id="office-name-input"
                type="text"
                class="filter-text-input"
                v-model="officeName"
                placeholder="Post office name (e.g. 東京中央郵便局)…"
              />
            </div>
            <div class="filter-control filter-control-actions">
              <button
                class="btn-primary btn-sm"
                type="button"
                @click="applyFilter"
                :disabled="loading.search || !hasAnyCriteria"
              >
                <i class="fa-solid fa-magnifying-glass"></i>
                <span>Search</span>
              </button>
              <button
                class="btn-ghost btn-sm"
                type="button"
                @click="resetFilter"
                :disabled="loadingAny"
              >
                Reset
              </button>
            </div>
            </div>
          </div>
        </section>

        <section class="results-section">
          <div v-if="loading.search" class="results-state">
            <div class="results-spinner"></div>
            <p>Loading scenic stamp data from local database…</p>
          </div>
          <div v-else-if="error" class="results-state results-state-error">
            <p>{{ error }}</p>
          </div>
          <div v-else-if="!items.length" class="results-state">
            <p>No results. </p>
          </div>
          <div v-else class="results-grid">
            <article
              v-for="item in items"
              :key="item.id"
              class="fuke-card"
            >
              <div class="fuke-card-header">
                <div class="fuke-card-title">
                  <span class="fuke-name">{{ item.name }}</span>
                  <span
                    class="fuke-tag fuke-tag-status"
                    :class="{ 'fuke-tag-abolished': item.abolition }"
                  >
                    {{ item.abolition ? '廃止' : '現行' }}
                  </span>
                </div>
                <div class="fuke-card-meta">
                  <span class="meta-chip">
                    <i class="fa-regular fa-compass"></i>
                    <span>{{ item.prefecture_name }} · {{ item.city_name }}</span>
                  </span>
                  <span v-if="item.start_date" class="meta-chip">
                    <i class="fa-regular fa-calendar"></i>
                    <span>使用開始 {{ item.start_date }}</span>
                  </span>
                </div>
              </div>

              <div class="fuke-card-body">
                <div class="fuke-card-image" v-if="item.image_url">
                  <img :src="item.image_url" :alt="item.name" loading="lazy" />
                </div>
                <div class="fuke-card-details">
                  <p class="office-name">
                    <i class="fa-solid fa-building-columns"></i>
                    <span>{{ item.jpost_office_name }}</span>
                  </p>
                  <p class="office-address">
                    <span class="office-postcode">〒{{ item.jpost_office_postcode }}</span>
                    <span class="office-address-text">{{ item.jpost_office_address }}</span>
                  </p>
                  <p v-if="item.description" class="fuke-description">
                    <span class="meta-label">図案説明: </span>
                    {{ item.description }}
                  </p>
                  <p v-if="item.author" class="fuke-author">
                    <span class="meta-label">図案作者: </span>
                    <span class="meta-value">{{ item.author }}</span>
                  </p>
                </div>
              </div>
            </article>
          </div>

          <div v-if="items.length" class="results-pagination">
            <button
              class="btn-ghost btn-sm"
              type="button"
              @click="prevPage"
              :disabled="page <= 1 || loading.search"
            >
              <i class="fa-solid fa-arrow-left-long"></i>
              <span>Previous page</span>
            </button>
            <span class="pagination-status">
              <span class="meta-label">Current page</span>
              <span class="meta-value">{{ page }}</span>
            </span>
            <button
              class="btn-ghost btn-sm"
              type="button"
              @click="nextPage"
              :disabled="!hasNextPage || loading.search"
            >
              <span>Next page</span>
              <i class="fa-solid fa-arrow-right-long"></i>
            </button>
          </div>
        </section>

        <!-- Scenic postmark Q&A -->
        <section class="fuke-faq-section">
          <h2 class="filter-title">Collecting Fukei-ins in Japan</h2>

          <div class="fuke-faq-grid">
            <article class="fuke-faq-item">
              <h3 class="fuke-faq-question">Q1. What is a Fukei-in (風景印)?</h3>
              <p class="fuke-faq-answer">
                A fukei-in is a special circular cancellation used at certain post offices, whose design
                shows local landmarks, history or nature of that area. It is one type of &quot;special date stamp&quot;
                (特別日付印) provided by Japan Post for philatelic enjoyment.
              </p>
            </article>

            <article class="fuke-faq-item">
              <h3 class="fuke-faq-question">Q2. What do I need to bring to get a Fukei-in during travel?</h3>
              <p class="fuke-faq-answer">
                Prepare either postcards or envelopes or just a piece of paper with enough Japanese postage. For <strong>souvenir collecting</strong>
                (記念押印), you can stick stamps that meet the minimum postcard rate onto a card or postcard and ask for a
                fukei-in(currently,84 yen is enough for getting a fukei-in, however if you want to mail the postcard overseas, you may need 110 yen).
              </p>
            </article>

            <article class="fuke-faq-item">
              <h3 class="fuke-faq-question">Q3. How do I ask at the post office counter?</h3>
              <p class="fuke-faq-answer">
                Go to the postal counter (郵便窓口) and say something like
                <em>&quot;風景印をお願いします&quot; (&quot;Fūkei‑in o onegai shimasu&quot;)</em>, then hand over your stamped
                postcards or letters. Japan Post staff will apply the postmark; customers are not allowed to stamp it by themselves.
              </p>
            </article>

            <article class="fuke-faq-item">
              <h3 class="fuke-faq-question">Q4. Any etiquette or practical tips for collectors?</h3>
              <p class="fuke-faq-answer">
                Fukei-ins are hand‑applied, so small smudges or mis‑alignment are normal and not re‑stamped.
                Avoid asking for extremely precise positioning, avoid very busy times if you bring many items, and
                always bring enough stamps or Japanese postage in advance. Being polite and patient makes the experience
                smoother for both travelers and postal staff.
              </p>
            </article>
          </div>
        </section>
      </div>
    </section>
  </section>
{% endraw %}
{% endblock content %}

{% block body_scripts %}
  <script src="{{ url_for('static', path='js/fuke.js') }}"></script>
{% endblock body_scripts %}

